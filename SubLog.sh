#!/bin/bash
echo ""
echo  -e "[38;2;121;240;21m [39m[38;2;125;239;19m [39m[38;2;130;236;16mâ–ˆ[39m[38;2;134;234;14mâ–ˆ[39m[38;2;138;232;13mâ–ˆ[39m[38;2;142;229;11mâ–ˆ[39m[38;2;147;227;9mâ–ˆ[39m[38;2;151;224;8mâ–ˆ[39m[38;2;155;221;6mâ–ˆ[39m[38;2;159;218;5mâ–ˆ[39m[38;2;163;215;4m [39m[38;2;167;212;3m [39m[38;2;171;209;2m [39m[38;2;175;206;2m [39m[38;2;179;202;1m [39m[38;2;183;199;1m [39m[38;2;187;195;1m [39m[38;2;190;192;1m [39m[38;2;194;188;1m [39m[38;2;197;184;1mâ–ˆ[39m[38;2;201;180;1mâ–ˆ[39m[38;2;204;177;2m [39m[38;2;208;173;2m [39m[38;2;211;169;3m [39m[38;2;214;165;4m [39m[38;2;217;161;5m [39m[38;2;220;156;6m [39m[38;2;223;152;7mâ–ˆ[39m[38;2;226;148;9mâ–ˆ[39m[38;2;228;144;10m [39m[38;2;231;140;12m [39m[38;2;233;136;14m [39m[38;2;236;131;16m [39m[38;2;238;127;18m [39m[38;2;240;123;20m [39m[38;2;242;119;22m [39m[38;2;243;114;25m [39m[38;2;245;110;27m [39m[38;2;247;106;30m [39m[38;2;248;102;33m [39m[38;2;249;98;35m [39m[38;2;250;94;38m [39m[38;2;251;90;41m [39m[38;2;252;86;45m [39m[38;2;253;82;48m [39m[38;2;254;78;51m [39m[38;2;254;74;55m [39m[38;2;254;70;58m [39m[38;2;254;66;62m [39m[38;2;254;63;65m [39m[38;2;254;59;69m [39m[38;2;254;55;73m [39m[38;2;254;52;77m[39m
[38;2;134;234;14m [39m[38;2;138;232;13mâ–ˆ[39m[38;2;142;229;11mâ–ˆ[39m[38;2;147;227;9mâ–‘[39m[38;2;151;224;8mâ–‘[39m[38;2;155;221;6mâ–‘[39m[38;2;159;218;5mâ–‘[39m[38;2;163;215;4mâ–‘[39m[38;2;167;212;3mâ–‘[39m[38;2;171;209;2m [39m[38;2;175;206;2m [39m[38;2;179;202;1m [39m[38;2;183;199;1m [39m[38;2;187;195;1m [39m[38;2;190;192;1m [39m[38;2;194;188;1m [39m[38;2;197;184;1m [39m[38;2;201;180;1m [39m[38;2;204;177;2mâ–‘[39m[38;2;208;173;2mâ–ˆ[39m[38;2;211;169;3mâ–ˆ[39m[38;2;214;165;4m [39m[38;2;217;161;5m [39m[38;2;220;156;6m [39m[38;2;223;152;7m [39m[38;2;226;148;9m [39m[38;2;228;144;10mâ–‘[39m[38;2;231;140;12mâ–ˆ[39m[38;2;233;136;14mâ–ˆ[39m[38;2;236;131;16m [39m[38;2;238;127;18m [39m[38;2;240;123;20m [39m[38;2;242;119;22m [39m[38;2;243;114;25m [39m[38;2;245;110;27m [39m[38;2;247;106;30m [39m[38;2;248;102;33m [39m[38;2;249;98;35m [39m[38;2;250;94;38m [39m[38;2;251;90;41m [39m[38;2;252;86;45m [39m[38;2;253;82;48m [39m[38;2;254;78;51m [39m[38;2;254;74;55m [39m[38;2;254;70;58m [39m[38;2;254;66;62m [39m[38;2;254;63;65mâ–ˆ[39m[38;2;254;59;69mâ–ˆ[39m[38;2;254;55;73mâ–ˆ[39m[38;2;254;52;77mâ–ˆ[39m[38;2;253;49;81mâ–ˆ[39m[38;2;252;45;85m [39m[38;2;252;42;89m[39m
[38;2;147;227;9mâ–‘[39m[38;2;151;224;8mâ–ˆ[39m[38;2;155;221;6mâ–ˆ[39m[38;2;159;218;5m [39m[38;2;163;215;4m [39m[38;2;167;212;3m [39m[38;2;171;209;2m [39m[38;2;175;206;2m [39m[38;2;179;202;1m [39m[38;2;183;199;1m [39m[38;2;187;195;1m [39m[38;2;190;192;1mâ–ˆ[39m[38;2;194;188;1mâ–ˆ[39m[38;2;197;184;1m [39m[38;2;201;180;1m [39m[38;2;204;177;2m [39m[38;2;208;173;2mâ–ˆ[39m[38;2;211;169;3mâ–ˆ[39m[38;2;214;165;4mâ–‘[39m[38;2;217;161;5mâ–ˆ[39m[38;2;220;156;6mâ–ˆ[39m[38;2;223;152;7m [39m[38;2;226;148;9m [39m[38;2;228;144;10m [39m[38;2;231;140;12m [39m[38;2;233;136;14m [39m[38;2;236;131;16mâ–‘[39m[38;2;238;127;18mâ–ˆ[39m[38;2;240;123;20mâ–ˆ[39m[38;2;242;119;22m [39m[38;2;243;114;25m [39m[38;2;245;110;27m [39m[38;2;247;106;30m [39m[38;2;248;102;33m [39m[38;2;249;98;35m [39m[38;2;250;94;38m [39m[38;2;251;90;41m [39m[38;2;252;86;45mâ–ˆ[39m[38;2;253;82;48mâ–ˆ[39m[38;2;254;78;51mâ–ˆ[39m[38;2;254;74;55mâ–ˆ[39m[38;2;254;70;58mâ–ˆ[39m[38;2;254;66;62mâ–ˆ[39m[38;2;254;63;65m [39m[38;2;254;59;69m [39m[38;2;254;55;73mâ–ˆ[39m[38;2;254;52;77mâ–ˆ[39m[38;2;253;49;81mâ–‘[39m[38;2;252;45;85mâ–‘[39m[38;2;252;42;89mâ–‘[39m[38;2;251;39;93mâ–ˆ[39m[38;2;250;36;97mâ–ˆ[39m[38;2;248;33;101m[39m
[38;2;159;218;5mâ–‘[39m[38;2;163;215;4mâ–ˆ[39m[38;2;167;212;3mâ–ˆ[39m[38;2;171;209;2mâ–ˆ[39m[38;2;175;206;2mâ–ˆ[39m[38;2;179;202;1mâ–ˆ[39m[38;2;183;199;1mâ–ˆ[39m[38;2;187;195;1mâ–ˆ[39m[38;2;190;192;1mâ–ˆ[39m[38;2;194;188;1mâ–ˆ[39m[38;2;197;184;1mâ–‘[39m[38;2;201;180;1mâ–ˆ[39m[38;2;204;177;2mâ–ˆ[39m[38;2;208;173;2m [39m[38;2;211;169;3m [39m[38;2;214;165;4mâ–‘[39m[38;2;217;161;5mâ–ˆ[39m[38;2;220;156;6mâ–ˆ[39m[38;2;223;152;7mâ–‘[39m[38;2;226;148;9mâ–ˆ[39m[38;2;228;144;10mâ–ˆ[39m[38;2;231;140;12mâ–ˆ[39m[38;2;233;136;14mâ–ˆ[39m[38;2;236;131;16mâ–ˆ[39m[38;2;238;127;18mâ–ˆ[39m[38;2;240;123;20m [39m[38;2;242;119;22mâ–‘[39m[38;2;243;114;25mâ–ˆ[39m[38;2;245;110;27mâ–ˆ[39m[38;2;247;106;30m [39m[38;2;248;102;33m [39m[38;2;249;98;35m [39m[38;2;250;94;38m [39m[38;2;251;90;41m [39m[38;2;252;86;45m [39m[38;2;253;82;48m [39m[38;2;254;78;51mâ–ˆ[39m[38;2;254;74;55mâ–ˆ[39m[38;2;254;70;58mâ–‘[39m[38;2;254;66;62mâ–‘[39m[38;2;254;63;65mâ–‘[39m[38;2;254;59;69mâ–‘[39m[38;2;254;55;73mâ–ˆ[39m[38;2;254;52;77mâ–ˆ[39m[38;2;253;49;81mâ–‘[39m[38;2;252;45;85mâ–ˆ[39m[38;2;252;42;89mâ–ˆ[39m[38;2;251;39;93m [39m[38;2;250;36;97m [39m[38;2;248;33;101mâ–‘[39m[38;2;247;30;105mâ–ˆ[39m[38;2;245;28;109mâ–ˆ[39m[38;2;244;25;113m[39m
[38;2;171;209;2mâ–‘[39m[38;2;175;206;2mâ–‘[39m[38;2;179;202;1mâ–‘[39m[38;2;183;199;1mâ–‘[39m[38;2;187;195;1mâ–‘[39m[38;2;190;192;1mâ–‘[39m[38;2;194;188;1mâ–‘[39m[38;2;197;184;1mâ–‘[39m[38;2;201;180;1mâ–ˆ[39m[38;2;204;177;2mâ–ˆ[39m[38;2;208;173;2mâ–‘[39m[38;2;211;169;3mâ–ˆ[39m[38;2;214;165;4mâ–ˆ[39m[38;2;217;161;5m [39m[38;2;220;156;6m [39m[38;2;223;152;7mâ–‘[39m[38;2;226;148;9mâ–ˆ[39m[38;2;228;144;10mâ–ˆ[39m[38;2;231;140;12mâ–‘[39m[38;2;233;136;14mâ–ˆ[39m[38;2;236;131;16mâ–ˆ[39m[38;2;238;127;18mâ–‘[39m[38;2;240;123;20mâ–‘[39m[38;2;242;119;22mâ–‘[39m[38;2;243;114;25mâ–ˆ[39m[38;2;245;110;27mâ–ˆ[39m[38;2;247;106;30mâ–‘[39m[38;2;248;102;33mâ–ˆ[39m[38;2;249;98;35mâ–ˆ[39m[38;2;250;94;38m [39m[38;2;251;90;41m [39m[38;2;252;86;45m [39m[38;2;253;82;48m [39m[38;2;254;78;51m [39m[38;2;254;74;55m [39m[38;2;254;70;58mâ–‘[39m[38;2;254;66;62mâ–ˆ[39m[38;2;254;63;65mâ–ˆ[39m[38;2;254;59;69m [39m[38;2;254;55;73m [39m[38;2;254;52;77m [39m[38;2;253;49;81mâ–‘[39m[38;2;252;45;85mâ–ˆ[39m[38;2;252;42;89mâ–ˆ[39m[38;2;251;39;93mâ–‘[39m[38;2;250;36;97mâ–‘[39m[38;2;248;33;101mâ–ˆ[39m[38;2;247;30;105mâ–ˆ[39m[38;2;245;28;109mâ–ˆ[39m[38;2;244;25;113mâ–ˆ[39m[38;2;242;23;118mâ–ˆ[39m[38;2;240;20;122mâ–ˆ[39m[38;2;238;18;126m[39m
[38;2;183;199;1m [39m[38;2;187;195;1m [39m[38;2;190;192;1m [39m[38;2;194;188;1m [39m[38;2;197;184;1m [39m[38;2;201;180;1m [39m[38;2;204;177;2m [39m[38;2;208;173;2mâ–‘[39m[38;2;211;169;3mâ–ˆ[39m[38;2;214;165;4mâ–ˆ[39m[38;2;217;161;5mâ–‘[39m[38;2;220;156;6mâ–ˆ[39m[38;2;223;152;7mâ–ˆ[39m[38;2;226;148;9m [39m[38;2;228;144;10m [39m[38;2;231;140;12mâ–‘[39m[38;2;233;136;14mâ–ˆ[39m[38;2;236;131;16mâ–ˆ[39m[38;2;238;127;18mâ–‘[39m[38;2;240;123;20mâ–ˆ[39m[38;2;242;119;22mâ–ˆ[39m[38;2;243;114;25m [39m[38;2;245;110;27m [39m[38;2;247;106;30mâ–‘[39m[38;2;248;102;33mâ–ˆ[39m[38;2;249;98;35mâ–ˆ[39m[38;2;250;94;38mâ–‘[39m[38;2;251;90;41mâ–ˆ[39m[38;2;252;86;45mâ–ˆ[39m[38;2;253;82;48m [39m[38;2;254;78;51m [39m[38;2;254;74;55m [39m[38;2;254;70;58m [39m[38;2;254;66;62m [39m[38;2;254;63;65m [39m[38;2;254;59;69mâ–‘[39m[38;2;254;55;73mâ–ˆ[39m[38;2;254;52;77mâ–ˆ[39m[38;2;253;49;81m [39m[38;2;252;45;85m [39m[38;2;252;42;89m [39m[38;2;251;39;93mâ–‘[39m[38;2;250;36;97mâ–ˆ[39m[38;2;248;33;101mâ–ˆ[39m[38;2;247;30;105m [39m[38;2;245;28;109mâ–‘[39m[38;2;244;25;113mâ–‘[39m[38;2;242;23;118mâ–‘[39m[38;2;240;20;122mâ–‘[39m[38;2;238;18;126mâ–‘[39m[38;2;236;16;130mâ–ˆ[39m[38;2;234;14;135mâ–ˆ[39m[38;2;231;12;139m[39m
[38;2;194;188;1m [39m[38;2;197;184;1mâ–ˆ[39m[38;2;201;180;1mâ–ˆ[39m[38;2;204;177;2mâ–ˆ[39m[38;2;208;173;2mâ–ˆ[39m[38;2;211;169;3mâ–ˆ[39m[38;2;214;165;4mâ–ˆ[39m[38;2;217;161;5mâ–ˆ[39m[38;2;220;156;6mâ–ˆ[39m[38;2;223;152;7m [39m[38;2;226;148;9mâ–‘[39m[38;2;228;144;10mâ–‘[39m[38;2;231;140;12mâ–ˆ[39m[38;2;233;136;14mâ–ˆ[39m[38;2;236;131;16mâ–ˆ[39m[38;2;238;127;18mâ–ˆ[39m[38;2;240;123;20mâ–ˆ[39m[38;2;242;119;22mâ–ˆ[39m[38;2;243;114;25mâ–‘[39m[38;2;245;110;27mâ–ˆ[39m[38;2;247;106;30mâ–ˆ[39m[38;2;248;102;33mâ–ˆ[39m[38;2;249;98;35mâ–ˆ[39m[38;2;250;94;38mâ–ˆ[39m[38;2;251;90;41mâ–ˆ[39m[38;2;252;86;45m [39m[38;2;253;82;48mâ–‘[39m[38;2;254;78;51mâ–ˆ[39m[38;2;254;74;55mâ–ˆ[39m[38;2;254;70;58mâ–ˆ[39m[38;2;254;66;62mâ–ˆ[39m[38;2;254;63;65mâ–ˆ[39m[38;2;254;59;69mâ–ˆ[39m[38;2;254;55;73mâ–ˆ[39m[38;2;254;52;77mâ–ˆ[39m[38;2;253;49;81mâ–‘[39m[38;2;252;45;85mâ–‘[39m[38;2;252;42;89mâ–ˆ[39m[38;2;251;39;93mâ–ˆ[39m[38;2;250;36;97mâ–ˆ[39m[38;2;248;33;101mâ–ˆ[39m[38;2;247;30;105mâ–ˆ[39m[38;2;245;28;109mâ–ˆ[39m[38;2;244;25;113m [39m[38;2;242;23;118m [39m[38;2;240;20;122m [39m[38;2;238;18;126mâ–ˆ[39m[38;2;236;16;130mâ–ˆ[39m[38;2;234;14;135mâ–ˆ[39m[38;2;231;12;139mâ–ˆ[39m[38;2;229;11;143mâ–ˆ[39m[38;2;226;9;147m [39m[38;2;224;8;151m[39m
[38;2;204;177;2mâ–‘[39m[38;2;208;173;2mâ–‘[39m[38;2;211;169;3mâ–‘[39m[38;2;214;165;4mâ–‘[39m[38;2;217;161;5mâ–‘[39m[38;2;220;156;6mâ–‘[39m[38;2;223;152;7mâ–‘[39m[38;2;226;148;9mâ–‘[39m[38;2;228;144;10m [39m[38;2;231;140;12m [39m[38;2;233;136;14m [39m[38;2;236;131;16mâ–‘[39m[38;2;238;127;18mâ–‘[39m[38;2;240;123;20mâ–‘[39m[38;2;242;119;22mâ–‘[39m[38;2;243;114;25mâ–‘[39m[38;2;245;110;27mâ–‘[39m[38;2;247;106;30m [39m[38;2;248;102;33mâ–‘[39m[38;2;249;98;35mâ–‘[39m[38;2;250;94;38mâ–‘[39m[38;2;251;90;41mâ–‘[39m[38;2;252;86;45mâ–‘[39m[38;2;253;82;48m [39m[38;2;254;78;51m [39m[38;2;254;74;55m [39m[38;2;254;70;58mâ–‘[39m[38;2;254;66;62mâ–‘[39m[38;2;254;63;65mâ–‘[39m[38;2;254;59;69mâ–‘[39m[38;2;254;55;73mâ–‘[39m[38;2;254;52;77mâ–‘[39m[38;2;253;49;81mâ–‘[39m[38;2;252;45;85mâ–‘[39m[38;2;252;42;89m [39m[38;2;251;39;93m [39m[38;2;250;36;97mâ–‘[39m[38;2;248;33;101mâ–‘[39m[38;2;247;30;105mâ–‘[39m[38;2;245;28;109mâ–‘[39m[38;2;244;25;113mâ–‘[39m[38;2;242;23;118mâ–‘[39m[38;2;240;20;122m [39m[38;2;238;18;126m [39m[38;2;236;16;130m [39m[38;2;234;14;135mâ–‘[39m[38;2;231;12;139mâ–‘[39m[38;2;229;11;143mâ–‘[39m[38;2;226;9;147mâ–‘[39m[38;2;224;8;151mâ–‘[39m[38;2;221;6;156m [39m[38;2;218;5;160m [39m[38;2;215;4;164m[39m"
echo " "
# Define color variables
RED='\033[1;31m'
GREEN='\033[1;32m'
BLUE='\033[1;34m'
YELLOW='\033[1;33m'
CYAN='\033[1;36m'
PURPLE='\033[1;35m'
NC='\033[0m' # No Color

# Function to display script usage
usage() {
    echo "Usage: $0 [-w wordlist_file] <domain>"
    exit 1
}
# Check if at least domain is provided as an argument
if [ $# -lt 1 ]; then
    usage
fi

# Parse options
while getopts ":w:" opt; do
    case ${opt} in
        w )
            wordlist="$OPTARG"
            ;;
        \? )
            echo "Invalid option: $OPTARG" 1>&2
            usage
            ;;
        : )
            echo "Option -$OPTARG requires an argument." 1>&2
            usage
            ;;
    esac
done
shift $((OPTIND -1))
if [ -n "$wordlist" ]; then
    # Check if the specified wordlist exists
    if [ ! -f "$wordlist" ]; then
        echo "Error: Wordlist '$wordlist' not found."
        exit 1
    fi
fi
# Check if domain is provided
if [ $# -ne 1 ]; then
    usage
fi

domain="$1"
# Ask for folder name
echo -n -e "${YELLOW}Enter the folder name to save the text files: ${NC}" 
read folder_name

# Check if folder name is provided
if [ -z "$folder_name" ]; then
    echo -e "${RED}Error: Folder name cannot be empty.${NC}"
    exit 1
fi

# Check if folder exists, if not create it
if [ ! -d "$folder_name" ]; then
   sudo mkdir "$folder_name"
fi

# Change to the folder directory
cd "$folder_name" || exit 1

# Step 1: Find subdomains using sublist3r
echo
echo -e  "${BLUE}[1]${NC} ${YELLOW}Finding subdomains with sublist3r.${NC}"
sudo python -c "import sublist3r;subdomains = sublist3r.main('$domain', 50, 'sublist3r.tmp.txt' ,ports= None, silent=True, verbose= False, enable_bruteforce= False, engines=None)"

# Step 2: Find subdomains using subfinder
echo
echo -e -n "${BLUE}[2]${NC} ${YELLOW}Finding subdomains with subfinder.${NC}"
echo
sudo subfinder  -silent  -d $domain | sudo tee subfinder.tmp.txt > /dev/null
echo
# Step 3: Perform subdomain brute-force with puredns
echo -e  "${BLUE}[3]${NC} ${YELLOW}Subdomain bruteforce using puredns.${NC}"
brute=false
echo -n -e "${PURPLE}[+]${NC} ${CYAN}Do you want to Bruteforce?${NC} ${RED}(It will take time)${NC} (y/N): " 
read choice1
if [ "$choice1" = "y" ] || [ "$choice1" = "Y" ]; then
    brute=true
fi

if $brute; then    
    echo -e "${RED}NOTE: ${NC}This might take some time (30-35 mins)."
    # Check if the custom wordlist file exists
    if [ -f "$wordlist" ]; then

        # Create a directory to store the divided wordlists
        sudo mkdir -p divided_wordlists
        
        # Split the custom wordlist into 10 parts
        sudo split -n 10 "$wordlist" divided_wordlists/part-
        counter=0
        folder="divided_wordlists"
        for list in "$folder"/*; do
            if [ -f "$list" ]; then
            counter=$((counter + 1))
            # Run PureDNS command with the current divided wordlist
            puredns -q bruteforce --rate-limit-trusted 0 --resolvers-trusted ../resolv.txt "$list" --trusted-only "$domain" | sudo tee "puredns-file-${counter}.txt" > /dev/null
            # Print message indicating completion
            echo
            echo -e "${YELLOW}[+]${NC} ${GREEN}Subdomain bruteforce with divided wordlist $list completed. ðŸ—¸${NC}"
            echo
            sleep 10
            fi
        done

        # Remove the divided wordlists
        sudo rm -rf divided_wordlists
    else
        # Iterate over each file in the folder
        counter=0
        folder="../subdomain-wordlists"
        for list in "$folder"/*; do
            # Check if the file exists and is a regular file
            if [ -f "$list" ]; then
                counter=$((counter + 1))
                # Run PureDNS command with the current file
                puredns -q bruteforce --rate-limit-trusted 0 --resolvers-trusted ../resolv.txt "$list" --trusted-only "$domain" | sudo tee "puredns-file-${counter}.txt" > /dev/null
                # Print message indicating completion
                echo
                echo -e "${YELLOW}[+]${NC} ${GREEN}Subdomain bruteforce wordlist ${counter} completed. ðŸ—¸${NC}"
                echo
                sleep 10
            fi
        done
    fi
    cat puredns-file-* | sort | uniq | sudo tee puredns.tmp.txt > /dev/null
    sudo rm -f puredns-file-*
fi



# Step 4: Find subdomains using crt.sh
echo
echo -e "${BLUE}[4]${NC} ${YELLOW} Extracting subdomains from crt.sh.${NC}"
echo
curl -s "https://crt.sh/?q=%.$domain&output=json" | jq -r '.[].name_value' | sed 's/\*\.//g' | sort -u  | sudo tee crtsh.tmp.txt > /dev/null

# Step 5: Make a list of all unique subdomains from the temporary files
echo -e -n "${BLUE}[5]${NC} ${YELLOW} Combining all subdomains in subdomains.txt${NC}"

if $brute; then
    cat sublist3r.tmp.txt subfinder.tmp.txt  puredns.tmp.txt crtsh.tmp.txt| sort | uniq |sudo tee subdomains.txt > /dev/null
else
    cat sublist3r.tmp.txt subfinder.tmp.txt crtsh.tmp.txt| sort | uniq |sudo tee subdomains.txt > /dev/null
fi
echo
echo -e "${PURPLE}[+]${NC} ${YELLOW} Found subdomains are saved in subdomains.txt.${NC}"
# Step 6: Perform port scanning with naabu
echo
echo -e "${BLUE}[6]${NC} ${YELLOW} Scanning ports on each subdomain using naabu${NC}"

execute_loop=false

echo -n -e "${PURPLE}[+]${NC} ${CYAN}Do you want to scan ports on each subdomain?${NC} ${RED}(It will take time)${NC} (y/N): " 
read choice2

if [ "$choice2" = "y" ] || [ "$choice2" = "Y" ] ; then
    execute_loop=true
fi

if $execute_loop; then 
    echo -e "${PURPLE}[+]${NC} ${CYAN}Enter the ports or range of ports you want to scan separated by comma or dash.${NC}" 
    echo -n -e "${RED}Example. 80,443,8080... or 1-65535. Leave it blank if you want to scan for common ports only.${NC}: " 
    read ports
    echo
    if [ -z "$ports" ]; then
        naabu -silent -c 50 -l subdomains.txt | sudo tee subdomain-port.tmp.txt > /dev/null
    else
        naabu -silent -c 50 -l subdomains.txt -p "$ports" | sudo tee subdomain-port.tmp.txt > /dev/null
    fi
fi
# Step 7: Check accessibility of subdomains using curl
echo -e "${BLUE}[7]${NC} ${YELLOW} Checking accessibilty of found subdomains with curl.${NC}"
echo
# Define input file containing subdomains and ports
if $execute_loop; then
    INPUT_FILE="subdomain-port.tmp.txt"
    else 
    INPUT_FILE="subdomains.txt"
fi
# Define output files for HTTP and HTTPS accessible subdomains
HTTP_OUTPUT_FILE="http_accessible.txt"
HTTPS_OUTPUT_FILE="https_accessible.txt"

# Check if input file exists
if [ ! -f "$INPUT_FILE" ]; then
    echo "Error: Input file '$INPUT_FILE' not found."
    exit 1
fi

# Loop through each subdomain:port combination in the input file
while IFS= read -r subdomainwithport; do
    echo "Checking $subdomainwithport"
    echo
    # Check HTTP accessibility
    response_code=$(curl -s -o /dev/null -w "%{http_code}" --connect-timeout 10 --max-time 20 "http://$subdomainwithport")
    if [[ $response_code == 2* || $response_code == 3* ]]; then
        echo "$subdomainwithport" | sudo tee -a "$HTTP_OUTPUT_FILE" > /dev/null
        echo -e "${GREEN}HTTP access successful${NC}"
    else
        echo -e "${RED}HTTP access failed${NC}"
    fi

    # Check HTTPS accessibility
    response_code=$(curl -s -o /dev/null -w "%{http_code}" --connect-timeout 10 --max-time 20 "https://$subdomainwithport")
    if [[ $response_code == 2* || $response_code == 3* ]]; then
        echo "$subdomainwithport" | sudo tee -a "$HTTPS_OUTPUT_FILE"
        echo -e "${GREEN}HTTPS access successful${NC}"
    else
        echo -e "${RED}HTTPS access failed${NC}"
    fi

    echo "------------------------------------------"
done < "$INPUT_FILE"
# Add 'http://' at the start of each line in HTTP accessible file
sudo sed -i 's/^/http:\/\//' "$HTTP_OUTPUT_FILE"

# Add 'https://' at the start of each line in HTTPS accessible file
sudo sed -i 's/^/https:\/\//' "$HTTPS_OUTPUT_FILE"
echo
echo -e "${YELLOW}HTTP accessible subdomains saved to '$HTTP_OUTPUT_FILE'"
echo -e
echo -e "HTTPS accessible subdomains saved to '$HTTPS_OUTPUT_FILE'${NC}"

# Cleanup temporary files
sudo rm -f sublist3r.tmp.txt subfinder.tmp.txt puredns.tmp.txt crtsh.tmp.txt subdomain-port.tmp.txt

# Step 8: Check if HTTP accessible subdomains redirect to HTTPS
# Define output file for final HTTP accessible subdomains
echo
echo -e "${BLUE}[8]${NC}${YELLOW} Checking for HTTP redirection.${NC}"
FINAL_HTTP_OUTPUT_FILE="final_http_accessible.txt"

# Create an empty array to store redirected URLs
redirected_urls=()
echo
# Loop through each HTTP accessible subdomain
while IFS= read -r http_subdomain; do
    echo -e "Checking redirection for ${CYAN}$http_subdomain${NC}"
    # Perform curl request to check if HTTP redirects to HTTPS
    redirected_to=$(curl -s --head -o /dev/null -w "%{redirect_url}" --connect-timeout 10 --max-time 30 "$http_subdomain")

    # Check if the redirection URL starts with HTTPS
    if [[ "$redirected_to" =~ ^https:// ]]; then
        echo -e "${GREEN}Redirection to HTTPS found${NC}, removing $http_subdomain from final HTTP list."
        echo -e "Redirected to: $redirected_to"
        redirected_urls+=("$http_subdomain")
    else
        echo "${RED}No redirection to HTTPS found${NC}, keeping $http_subdomain"
    fi

    echo "------------------------------------------------------------------------------------------------------------------------"
done < "$HTTP_OUTPUT_FILE"

# Remove redirected URLs from the final HTTP list
tmpfile=$(mktemp)
printf '%s\n' "${redirected_urls[@]}" > "$tmpfile"

# Execute awk with the temporary file
sudo awk 'NR==FNR{a[$0];next} !($0 in a)' "$tmpfile" "$HTTP_OUTPUT_FILE" | sudo tee -a "$FINAL_HTTP_OUTPUT_FILE" > /dev/null

# Remove the temporary file
sudo rm "$tmpfile"
echo
echo -e "${PURPLE}Final HTTP accessible subdomains saved to '$FINAL_HTTP_OUTPUT_FILE'"
echo -e
echo -e "HTTPS accessible subdomains saved to '$HTTPS_OUTPUT_FILE'${NC}"
sudo rm -f http_accessible.txt
#Step 9: Combine all accessible subdomains
cat final_http_accessible.txt https_accessible.txt | sort | uniq | sudo tee $domain-subdomains.txt > /dev/null
echo
echo -e "${YELLOW}Subdomain enumeration completed. Results saved in $domain-subdomains.txt${NC}"
